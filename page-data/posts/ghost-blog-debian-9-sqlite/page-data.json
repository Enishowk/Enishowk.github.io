{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/ghost-blog-debian-9-sqlite","result":{"data":{"markdownRemark":{"id":"183814f5-13dc-5b61-a3d6-867598867cda","html":"<p>Ghost recommande :</p>\n<ul>\n<li>Ubuntu 16.04</li>\n<li>MySQL</li>\n<li>NGINX (minimum of 1.9.5 for SSL)</li>\n<li>Node v6 installed via NodeSource</li>\n</ul>\n<p>Bien sûr, mon serveur tourne sous Debian 9, Apache, Node 8.9 et je voulais une base de données Sqlite. </p>\n<p>Après avoir eu quelques problèmes pendant l’installation, je voulais faire un petit post explicatif à ce sujet.</p>\n<h1 id=\"installation-dapache-nodejs\" style=\"position:relative;\"><a href=\"#installation-dapache-nodejs\" aria-label=\"installation dapache nodejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation d’Apache, NodeJS</h1>\n<p>Je pars du principe que vous avez déjà Debian 9 à jour, Apache et Node d’installés. Mais si besoin, voici les commandes pour les installer.</p>\n<p><code class=\"language-text\">$ apt-get install apache2</code>  </p>\n<p><code class=\"language-text\">$ curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -</code><br>\n<code class=\"language-text\">$ sudo apt-get install -y nodejs</code>  </p>\n<h1 id=\"ajout-dun-utilisateur\" style=\"position:relative;\"><a href=\"#ajout-dun-utilisateur\" aria-label=\"ajout dun utilisateur permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ajout d’un utilisateur</h1>\n<p>On va tout d’abord commencer par créer un nouvel utilisateur, évitant ainsi de lancer notre serveur node en tant que root. Ghost précise :</p>\n<blockquote>\n<p>N’appelez pas votre utilisateur <strong>ghost</strong>, l’outil Ghost-CLI va créer un utilisateur <strong>ghost</strong> pour administrer le blog. L’utilisateur que vous créez va être utilisé pour administrer le serveur.</p>\n</blockquote>\n<p>Il suffit donc de lui trouver un joli nom et de le créer avec cette commande :<br>\n<code class=\"language-text\">$ adduser &lt;votreUser&gt;</code>  </p>\n<p>L’utilisateur fraîchement créé a besoin des privilèges Super Utilisateur plus tard, pour cela :<br>\n<code class=\"language-text\">$ usermod -aG sudo &lt;votreUser&gt;</code>  </p>\n<p>On peut maintenant se logger avec :<br>\n<code class=\"language-text\">$ su - &lt;votreUser&gt;</code>  </p>\n<h1 id=\"installation-de-ghost\" style=\"position:relative;\"><a href=\"#installation-de-ghost\" aria-label=\"installation de ghost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation de Ghost</h1>\n<p>Ghost fournit un outil pour l’administration serveur de son moteur de blog. Il permet d’installer, de mettre à jour, de supprimer, ou même de démarrer son blog et de lister les blogs si vous en avez plusieurs.\nLa commande pour récupérer cet outil :<br>\n<code class=\"language-text\">$ sudo npm i -g ghost-cli</code>  </p>\n<p>Maintenant que <code class=\"language-text\">ghost-cli</code> est disponible, il faut choisir le dossier d’installation, en être le propriétaire (avec le nouvel utilisateur), et s’y rendre.<br>\n<code class=\"language-text\">$ sudo mkdir -p /var/www/ghost</code><br>\n<code class=\"language-text\">$ sudo chown [votreUser]:[votreUser] /var/www/ghost</code><br>\n<code class=\"language-text\">$ cd /var/www/ghost</code>  </p>\n<p>Et c’est ici que cela se complique (pas beaucoup je vous rassure).\nGhost est fait pour fonctionner avec une base de données MySQL. Il faut donc, pour utiliser une base de données Sqlite, ajouter le paramètre <strong>local</strong> à la commande d’install.</p>\n<p><code class=\"language-text\">$ ghost install local</code></p>\n<p>Cela va installer le blog dans le dossier courant. </p>\n<blockquote>\n<p>Il est fort probable que vous ayez une erreur sqlite client. Pour cela, il faut désinstaller <code class=\"language-text\">ghost-cli</code> et le reinstaller… Et si vous avez l’erreur npm qui va avec, voici donc la commande miracle, trouvée sur leur Github.</p>\n</blockquote>\n<p><code class=\"language-text\">$ sudo npm un -g ghost-cli &amp;&amp; sudo npm i --unsafe-perm -g ghost-cli</code></p>\n<p>Vous pouvez ensuite relancer la commande d’install si besoin, tout devrait fonctionner.</p>\n<p><em>Quelques commandes utiles :</em>  </p>\n<ul>\n<li>Démarrer le blog : <code class=\"language-text\">$ ghost start</code>  </li>\n<li>Lister les blogs : <code class=\"language-text\">$ ghost ls</code>  </li>\n<li>Arrêter le blog : <code class=\"language-text\">$ ghost stop</code>  </li>\n</ul>\n<h1 id=\"apache---vhost\" style=\"position:relative;\"><a href=\"#apache---vhost\" aria-label=\"apache   vhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Apache - VHost</h1>\n<p>Une fois l’installation effectuée, il faut s’occuper de la partie Apache.\nPour cela, rien de plus simple, il suffit d’ajouter un VHost dans le dossier <strong>sites-available</strong> d’Apache.\n<code class=\"language-text\">$ sudo vim /etc/apache2/sites-available/ghostblog.conf</code></p>\n<p>Voici un exemple de configuration à ajouter dans le fichier de conf.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;VirtualHost *:80&gt;\n    #Domain Name\n    ServerName votredomaine.fr\n    ServerAlias www.votredomaine.fr\n\n    #HTTP proxy/gateway server\n    ProxyRequests off \n    ProxyPass / http://127.0.0.1:2368/ \n    ProxyPassReverse / http:/127.0.0.1:2368/     \n&lt;/VirtualHost&gt;</code></pre></div>\n<p>Activez ensuite les modules <code class=\"language-text\">proxy</code> et <code class=\"language-text\">proxy_http</code>.<br>\n<code class=\"language-text\">$ sudo a2enmod proxy proxy_http</code>  </p>\n<p>Activez maintenant le site.<br>\n<code class=\"language-text\">$ sudo a2ensite ghostblog</code>  </p>\n<p>Il ne reste plus qu’à redémarrer Apache et Ghost.<br>\n<code class=\"language-text\">$ sudo systemctl restart apache2</code><br>\n<code class=\"language-text\">$ sudo systemctl restart ghost</code>  </p>\n<h1 id=\"custom-domain\" style=\"position:relative;\"><a href=\"#custom-domain\" aria-label=\"custom domain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom domain</h1>\n<p>Pour utiliser votre propre domaine, une configuration est nécessaire au niveau de votre fournisseur de domaine.\nSi vous êtes chez OVH, il faut vous rendre sur votre espace client, aller dans l’administration de votre domaine et cliquer sur l’onglet <strong>Zone DNS</strong>.\nIci, cliquez sur <strong>Ajouter une entrée</strong> et choisissez le champ DNS de type A.\nRentrez l’adresse IP de votre serveur dans le champ <strong>Cible</strong> et validez.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 596px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/febd3edf70df62ea6bb56d2c820fe867/b1503/dns1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd1IYk//xAAYEAACAwAAAAAAAAAAAAAAAAAAERAhMf/aAAgBAQABBQKbMGz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAEBAQADAQAAAAAAAAAAAAABABExQVFx/9oACAEBAAE/IcgsPJ+LeyQeCX//2gAMAwEAAgADAAAAEDDf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EGx//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QR//EABsQAQEBAAIDAAAAAAAAAAAAAAERACFBgdHh/9oACAEBAAE/EGbWHj1gDnnW+MEvTTkKVkYx73//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/febd3edf70df62ea6bb56d2c820fe867/8ac56/dns1.webp 240w,\n/static/febd3edf70df62ea6bb56d2c820fe867/d3be9/dns1.webp 480w,\n/static/febd3edf70df62ea6bb56d2c820fe867/3cb93/dns1.webp 596w\"\n          sizes=\"(max-width: 596px) 100vw, 596px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/febd3edf70df62ea6bb56d2c820fe867/09b79/dns1.jpg 240w,\n/static/febd3edf70df62ea6bb56d2c820fe867/7cc5e/dns1.jpg 480w,\n/static/febd3edf70df62ea6bb56d2c820fe867/b1503/dns1.jpg 596w\"\n          sizes=\"(max-width: 596px) 100vw, 596px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/febd3edf70df62ea6bb56d2c820fe867/b1503/dns1.jpg\"\n          alt=\"dns1\"\n          title=\"dns1\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>La mise à jour des DNS n’est pas instantanée. Attendez quelques heures pour que votre nom de domaine pointe bien vers votre serveur.</p>\n<h1 id=\"ssl\" style=\"position:relative;\"><a href=\"#ssl\" aria-label=\"ssl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSL</h1>\n<p>Pour finir, voici comment mettre en place un certificat TLS/SSL sur le serveur Apache en quelques minutes.</p>\n<p>Pour cela, nous allons utiliser l’outil <code class=\"language-text\">cerbot</code>.  </p>\n<p>L’installation se fait à travers cette commande :<br>\n<code class=\"language-text\">$ sudo apt-get install python-certbot-apache</code></p>\n<p>Ensuite, exécutez la commande<br>\n<code class=\"language-text\">$ sudo certbot --apache</code></p>\n<p><strong>Certbot</strong> récupère un certificat et met à jour la configuration des Vhost d’Apache qu’il trouve.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/73c6d4de1e43ebccf062542b65d3d438/46b1b/SSL1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcOAqD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAWEAEBAQAAAAAAAAAAAAAAAAAAEYH/2gAIAQEAAT8h1Ef/2gAMAwEAAgADAAAAEAPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAFxABAQEBAAAAAAAAAAAAAAAAAREAMf/aAAgBAQABPxBFejN2vNG//9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/73c6d4de1e43ebccf062542b65d3d438/8ac56/SSL1.webp 240w,\n/static/73c6d4de1e43ebccf062542b65d3d438/d3be9/SSL1.webp 480w,\n/static/73c6d4de1e43ebccf062542b65d3d438/7eb86/SSL1.webp 642w\"\n          sizes=\"(max-width: 642px) 100vw, 642px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/73c6d4de1e43ebccf062542b65d3d438/09b79/SSL1.jpg 240w,\n/static/73c6d4de1e43ebccf062542b65d3d438/7cc5e/SSL1.jpg 480w,\n/static/73c6d4de1e43ebccf062542b65d3d438/46b1b/SSL1.jpg 642w\"\n          sizes=\"(max-width: 642px) 100vw, 642px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/73c6d4de1e43ebccf062542b65d3d438/46b1b/SSL1.jpg\"\n          alt=\"SSL1\"\n          title=\"SSL1\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Sélectionnez donc vos domaines et appuyez sur entrer.</p>\n<p>Les certificats proposés par Certbot (Let’s Encrypt) ne sont valables que 90 jours, il faut donc les renouveler. Pour cela, on peut utiliser la commande <code class=\"language-text\">certbot renew</code> et créer une tâche récurrente qui exécutera cette commande.\nLancez la commande :<br>\n<code class=\"language-text\">$ sudo crontab -e</code><br>\nEt ajoutez cette ligne :<br>\n<code class=\"language-text\">0 4 * * 7 certbot renew</code>  </p>\n<p>Les certificats seront ainsi mis à jour chaque semaine, le dimanche à 4h du matin.</p>\n<p>Voilà, votre blog est maintenant configuré sur votre serveur. N’hésitez pas à venir me parler sur Twitter si vous avez des questions ou suggestions. </p>","fields":{"slug":"/posts/ghost-blog-debian-9-sqlite","tagSlugs":["/tag/dev/","/tag/ghost/","/tag/debian/","/tag/sqlite/","/tag/apache/","/tag/node/","/tag/ssl/"]},"frontmatter":{"date":"2017-11-17","description":"Le moteur de blog de Ghost est assez bien foutu, tourne avec NodeJS et permet une customisation assez poussée. Cependant, son installation peut s'avérer problématique lorsque l'on s'écarte des recommandations.","tags":["Dev","Ghost","Debian","Sqlite","Apache","Node","SSL"],"title":"Ghost, Debian 9, Sqlite, Apache, Node 8.9, SSL"}}},"pageContext":{"slug":"/posts/ghost-blog-debian-9-sqlite"}},"staticQueryHashes":["1307906156","251939775","401334301"]}